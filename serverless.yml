service:
  name: kaskadi-webhooks-tracking-lambda

package:
  individually: true
  exclude:
    - "**/**"

provider:
  name: aws
  runtime: nodejs12.x
  stackName: ${self:service.name}-stack
  stage: ${opt:stage, 'prod'}
  region: eu-central-1
  deploymentBucket:
    name: kaskadi-serverless-deployment-bucket
  apiGateway:
    restApiId: !ImportValue KaskadiWebhooksRestAPIGatewayId
    restApiRootResourceId: !ImportValue KaskadiWebhooksRestAPIGatewayRootResourceId

functions:
  KaskadiWebhooksTracking:
    handler: kaskadi-webhooks-tracking-lambda.handler
    layers:
      - !ImportValue KaskadiEsLayerArn
    name: ${self:service.name}
    package:
      include:
        - 'kaskadi-webhooks-tracking-lambda.js'
        - 'node_modules/**'
    environment:
      ES_ACCESS_ID: ${env:ES_ACCESS_ID}
      ES_ACCESS_SECRET: ${env:ES_ACCESS_SECRET}
      YSWS_TOKEN: ${env:YSWS_TOKEN}
    events:
      - http:
          method: post
          path: tracking
          cors: true
